#include <ttak/security/seed.h>
#include <stdint.h>
#include <stdio.h>
#include <string.h>

#include "test_macros.h"

static void run_case(const uint8_t *key,
                     const uint8_t *plain,
                     const uint8_t *expected) {
    ttak_crypto_ctx_t ctx = {0};
    uint8_t output[16];
    ttak_security_driver_t driver = {
        .kind = TTAK_SECURITY_DRIVER_SCALAR,
        .name = "scalar",
        .lane_width = 1
    };

    ctx.key = key;
    ctx.key_len = 16;
    ctx.in = plain;
    ctx.in_len = sizeof(output);
    ctx.out = output;
    ctx.out_len = sizeof(output);
    ctx.block_size = 16;
    ctx.hw_state.seed.rounds = 0;

    ASSERT(ttak_seed_encrypt_aligned(&ctx, &driver) == TTAK_IO_SUCCESS);
    if (memcmp(output, expected, sizeof(output)) != 0) {
        fprintf(stderr, "[SEED] mismatch\\nexpected: ");
        for (size_t i = 0; i < sizeof(output); ++i) fprintf(stderr, "%02X", expected[i]);
        fprintf(stderr, "\\nactual  : ");
        for (size_t i = 0; i < sizeof(output); ++i) fprintf(stderr, "%02X", output[i]);
        fprintf(stderr, "\\n");
    }
    ASSERT(memcmp(output, expected, sizeof(output)) == 0);
}

static void test_seed_vectors(void) {
    static const uint8_t key1[16] = {0};
    static const uint8_t plain1[16] = {
        0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,
        0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F
    };
    static const uint8_t cipher1[16] = {
        0x5E,0xBA,0xC6,0xE0,0x05,0x4E,0x16,0x68,
        0x19,0xAF,0xF1,0xCC,0x6D,0x34,0x6C,0xDB
    };

    static const uint8_t key2[16] = {
        0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,
        0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F
    };
    static const uint8_t plain2[16] = {0};
    static const uint8_t cipher2[16] = {
        0xC1,0x1F,0x22,0xF2,0x01,0x40,0x50,0x50,
        0x84,0x48,0x35,0x97,0xE4,0x37,0x0F,0x43
    };

    static const uint8_t key3[16] = {
        0x47,0x06,0x48,0x08,0x51,0xE6,0x1B,0xE8,
        0x5D,0x74,0xBF,0xB3,0xFD,0x95,0x61,0x85
    };
    static const uint8_t plain3[16] = {
        0x83,0xA2,0xF8,0xA2,0x88,0x64,0x1F,0xB9,
        0xA4,0xE9,0xA5,0xCC,0x2F,0x13,0x1C,0x7D
    };
    static const uint8_t cipher3[16] = {
        0xEE,0x54,0xD1,0x3E,0xBC,0xAE,0x70,0x6D,
        0x22,0x6B,0xC3,0x14,0x2C,0xD4,0x0D,0x4A
    };

    static const uint8_t key4[16] = {
        0x28,0xDB,0xC3,0xBC,0x49,0xFF,0xD8,0x7D,
        0xCF,0xA5,0x09,0xB1,0x1D,0x42,0x2B,0xE7
    };
    static const uint8_t plain4[16] = {
        0xB4,0x1E,0x6B,0xE2,0xEB,0xA8,0x4A,0x14,
        0x8E,0x2E,0xED,0x84,0x59,0x3C,0x5E,0xC7
    };
    static const uint8_t cipher4[16] = {
        0x9B,0x9B,0x7B,0xFC,0xD1,0x81,0x3C,0xB9,
        0x5D,0x0B,0x36,0x18,0xF4,0x0F,0x51,0x22
    };

    run_case(key1, plain1, cipher1);
    run_case(key2, plain2, cipher2);
    run_case(key3, plain3, cipher3);
    run_case(key4, plain4, cipher4);
}

int main(void) {
    RUN_TEST(test_seed_vectors);
    return 0;
}
