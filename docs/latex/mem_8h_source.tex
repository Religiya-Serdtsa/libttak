\doxysection{mem.\+h}
\hypertarget{mem_8h_source}{}\label{mem_8h_source}\index{include/ttak/mem/mem.h@{include/ttak/mem/mem.h}}
\mbox{\hyperlink{mem_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00001}00001\ \textcolor{preprocessor}{\#ifndef\ TTAK\_MEM\_H}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00002}00002\ \textcolor{preprocessor}{\#define\ TTAK\_MEM\_H}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <stddef.h>}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <stdbool.h>}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00007}00007\ \textcolor{preprocessor}{\#include\ <stdalign.h>}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <pthread.h>}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00009}00009\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{atomic_8h}{ttak/atomic/atomic.h}}>}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00010}00010\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00011}00011\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00012}00012\ \textcolor{comment}{\ *\ @brief\ Alignment\ for\ cache-\/line\ optimization\ (64-\/byte).}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00013}00013\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00014}\mbox{\hyperlink{mem_8h_a56bacec5f02dbd8cad7b15e6682fbf20}{00014}}\ \textcolor{preprocessor}{\#define\ TTAK\_CACHE\_LINE\_SIZE\ 64}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00015}00015\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00016}00016\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00017}00017\ \textcolor{comment}{\ *\ @brief\ Macro\ to\ indicate\ that\ the\ allocated\ memory\ should\ persist\ forever.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00018}00018\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00019}\mbox{\hyperlink{mem_8h_a798ceb4ce7e1d84af3001d7ec38d3da2}{00019}}\ \textcolor{preprocessor}{\#define\ \_\_TTAK\_UNSAFE\_MEM\_FOREVER\_\_\ ((uint64\_t)-\/1)}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00020}00020\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00021}00021\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00022}00022\ \textcolor{comment}{\ *\ @brief\ "{}Fortress"{}\ Magic\ Number\ for\ header\ validation.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00023}00023\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00024}\mbox{\hyperlink{mem_8h_a02d61fafa21eadc8010ca9803d77bafb}{00024}}\ \textcolor{preprocessor}{\#define\ TTAK\_MAGIC\_NUMBER\ 0x5454414B}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00025}00025\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00026}00026\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00027}00027\ \textcolor{comment}{\ *\ @brief\ Sentinel\ for\ invalidated\ references.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00028}00028\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00029}\mbox{\hyperlink{mem_8h_ac5b096c74969e7dbd5e24d44a446c015}{00029}}\ \textcolor{preprocessor}{\#define\ SAFE\_NULL\ NULL}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00030}00030\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00031}00031\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00032}00032\ \textcolor{comment}{\ *\ @brief\ "{}Fortress"{}\ Memory\ Header.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00033}00033\ \textcolor{comment}{\ *\ 64-\/byte\ aligned\ to\ prevent\ False\ Sharing\ and\ ensure\ user\ pointer\ alignment.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00034}00034\ \textcolor{comment}{\ *\ Total\ size\ is\ 128\ bytes\ to\ maintain\ 64-\/byte\ alignment\ for\ user\ data.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00035}00035\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00036}\mbox{\hyperlink{structttak__mem__header__t}{00036}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00037}\mbox{\hyperlink{structttak__mem__header__t_a63c543d0e2277438790686ca125adadf}{00037}}\ \ \ \ \ \textcolor{keyword}{alignas}(64)\ uint32\_t\ magic;\ \ \ \ \ \ \ \ \ \textcolor{comment}{/**<\ 0x5454414B\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00038}\mbox{\hyperlink{structttak__mem__header__t_a49f32c7dc3f8c633c289870c99841153}{00038}}\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{structttak__mem__header__t_a49f32c7dc3f8c633c289870c99841153}{checksum}};\ \ \ \ \ \ \textcolor{comment}{/**<\ Metadata\ checksum\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00039}\mbox{\hyperlink{structttak__mem__header__t_aefba5a41d63f62a6de53c3a9a6f0f51b}{00039}}\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{structttak__mem__header__t_aefba5a41d63f62a6de53c3a9a6f0f51b}{created\_tick}};\ \ \textcolor{comment}{/**<\ Creation\ timestamp\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00040}\mbox{\hyperlink{structttak__mem__header__t_a0362d896df5d92be01157426136ad6b0}{00040}}\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{structttak__mem__header__t_a0362d896df5d92be01157426136ad6b0}{expires\_tick}};\ \ \textcolor{comment}{/**<\ Expiration\ timestamp\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00041}\mbox{\hyperlink{structttak__mem__header__t_a0318bb3cfda8bb54cf6ec0c43e6b2584}{00041}}\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{structttak__mem__header__t_a0318bb3cfda8bb54cf6ec0c43e6b2584}{access\_count}};\ \ \textcolor{comment}{/**<\ Atomic\ access\ audit\ counter\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00042}\mbox{\hyperlink{structttak__mem__header__t_a6f56f8247cfdee283312f6d76b0625a1}{00042}}\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{structttak__mem__header__t_a6f56f8247cfdee283312f6d76b0625a1}{pin\_count}};\ \ \ \ \ \textcolor{comment}{/**<\ Atomic\ reference\ count\ for\ pinning\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00043}\mbox{\hyperlink{structttak__mem__header__t_a576f96336f81e4af314e70b911232dda}{00043}}\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \mbox{\hyperlink{structttak__mem__header__t_a576f96336f81e4af314e70b911232dda}{size}};\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/**<\ User-\/requested\ size\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00044}\mbox{\hyperlink{structttak__mem__header__t_a5c63e95556a7b6528834155059dae312}{00044}}\ \ \ \ \ pthread\_mutex\_t\ \mbox{\hyperlink{structttak__mem__header__t_a5c63e95556a7b6528834155059dae312}{lock}};\ \ \ \textcolor{comment}{/**<\ Per-\/header\ synchronization\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00045}\mbox{\hyperlink{structttak__mem__header__t_a86b5bea8ae5d34192969173c8ea7ef88}{00045}}\ \ \ \ \ \_Bool\ \ \ \ \mbox{\hyperlink{structttak__mem__header__t_a86b5bea8ae5d34192969173c8ea7ef88}{freed}};\ \ \ \ \ \ \ \ \ \textcolor{comment}{/**<\ Allocation\ status\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00046}\mbox{\hyperlink{structttak__mem__header__t_a5bf1a1bf467c6b8f9df7c13ff72ee660}{00046}}\ \ \ \ \ \_Bool\ \ \ \ \mbox{\hyperlink{structttak__mem__header__t_a5bf1a1bf467c6b8f9df7c13ff72ee660}{is\_const}};\ \ \ \ \ \ \textcolor{comment}{/**<\ Immutability\ hint\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00047}\mbox{\hyperlink{structttak__mem__header__t_a69a6983e3aa59121684422c82714b3c9}{00047}}\ \ \ \ \ \_Bool\ \ \ \ \mbox{\hyperlink{structttak__mem__header__t_a69a6983e3aa59121684422c82714b3c9}{is\_volatile}};\ \ \ \textcolor{comment}{/**<\ Volatility\ hint\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00048}\mbox{\hyperlink{structttak__mem__header__t_afebc4673ac816dd1ca85e2368dee4694}{00048}}\ \ \ \ \ \_Bool\ \ \ \ \mbox{\hyperlink{structttak__mem__header__t_afebc4673ac816dd1ca85e2368dee4694}{allow\_direct\_access}};\ \textcolor{comment}{/**<\ Safety\ bypass\ flag\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00049}\mbox{\hyperlink{structttak__mem__header__t_aec81dfe0c2ad6a934ac1daae25d1c823}{00049}}\ \ \ \ \ \_Bool\ \ \ \ \mbox{\hyperlink{structttak__mem__header__t_aec81dfe0c2ad6a934ac1daae25d1c823}{is\_huge}};\ \ \ \ \ \ \ \textcolor{comment}{/**<\ Mapped\ via\ hugepages\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00050}\mbox{\hyperlink{structttak__mem__header__t_a8430c7b034f0da69e2fe16ae2a999e2d}{00050}}\ \ \ \ \ \_Bool\ \ \ \ \mbox{\hyperlink{structttak__mem__header__t_a8430c7b034f0da69e2fe16ae2a999e2d}{should\_join}};\ \ \ \textcolor{comment}{/**<\ Indicates\ if\ associated\ resource\ needs\ joining\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00051}\mbox{\hyperlink{structttak__mem__header__t_ad1189a2d1c2973b2537c1e4d34a0d439}{00051}}\ \ \ \ \ \_Bool\ \ \ \ strict\_check;\ \_Bool\ \ \ \ \mbox{\hyperlink{structttak__mem__header__t_ad1189a2d1c2973b2537c1e4d34a0d439}{is\_root}};\ \ \textcolor{comment}{/**<\ Enable\ strict\ memory\ boundary\ checks\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00052}\mbox{\hyperlink{structttak__mem__header__t_aeb69c52bed0292761ce4ff581eae37df}{00052}}\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{structttak__mem__header__t_aeb69c52bed0292761ce4ff581eae37df}{canary\_start}};\ \ \textcolor{comment}{/**<\ Magic\ number\ for\ start\ of\ user\ data\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00053}\mbox{\hyperlink{structttak__mem__header__t_a9bc5cff0708537fe474f41e356e69284}{00053}}\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{structttak__mem__header__t_a9bc5cff0708537fe474f41e356e69284}{canary\_end}};\ \ \ \ \textcolor{comment}{/**<\ Magic\ number\ for\ end\ of\ user\ data\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00054}\mbox{\hyperlink{structttak__mem__header__t_a4c9d2514539339c34bed60e2bdd5e233}{00054}}\ \ \ \ \ \textcolor{keywordtype}{char}\ \ \ \ \ *\mbox{\hyperlink{structttak__mem__header__t_a4c9d2514539339c34bed60e2bdd5e233}{tracking\_log}};\ \ \textcolor{comment}{/**<\ Memory\ operation\ tracking\ log\ (dynamic)\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00055}\mbox{\hyperlink{structttak__mem__header__t_acc4f1b34d6e7f6d2e71755779a88ffa3}{00055}}\ \ \ \ \ \textcolor{keywordtype}{char}\ \ \ \ \ reserved[11];\ \ \textcolor{comment}{/**<\ Explicit\ padding\ for\ header\ alignment\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00056}00056\ \}\ \mbox{\hyperlink{structttak__mem__header__t}{ttak\_mem\_header\_t}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00057}00057\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00058}00058\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00059}00059\ \textcolor{comment}{\ *\ @brief\ Memory\ allocation\ flags.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00060}00060\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00061}\mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdad}{00061}}\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00062}\mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdadab57ac5f60f1170e17ecfe853611ac80a}{00062}}\ \ \ \ \ \mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdadab57ac5f60f1170e17ecfe853611ac80a}{TTAK\_MEM\_DEFAULT}}\ =\ 0,}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00063}\mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdadaa4cff10407296a029dba423e1ac75551}{00063}}\ \ \ \ \ \mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdadaa4cff10407296a029dba423e1ac75551}{TTAK\_MEM\_HUGE\_PAGES}}\ =\ (1\ <<\ 0),\ \textcolor{comment}{/**\ Try\ to\ use\ 2MB/1GB\ pages\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00064}\mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdada85fc84c07c8164ea4cd8048365cc3e2d}{00064}}\ \ \ \ \ \mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdada85fc84c07c8164ea4cd8048365cc3e2d}{TTAK\_MEM\_CACHE\_ALIGNED}}\ =\ (1\ <<\ 1),\ \textcolor{comment}{/**\ Force\ 64-\/byte\ alignment\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00065}00065\ \ \ \ \ \mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdada0b16ffc2f709ae7e7a5439e0ca8d7d86}{TTAK\_MEM\_STRICT\_CHECK}}\ =\ (1\ <<\ 2)\ \textcolor{comment}{/**\ Enable\ strict\ memory\ boundary\ checks\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00066}\mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdada0b16ffc2f709ae7e7a5439e0ca8d7d86}{00066}}\ \}\ \mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdad}{ttak\_mem\_flags\_t}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00067}00067\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00068}00068\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00069}00069\ \textcolor{comment}{\ *\ @brief\ Unified\ memory\ allocation\ with\ lifecycle\ management\ and\ hardware\ optimization.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00070}00070\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00071}\mbox{\hyperlink{mem_8h_aff3d4e6c920caf8bdeee3b2561a2ae46}{00071}}\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{mem_8h_aff3d4e6c920caf8bdeee3b2561a2ae46}{ttak\_mem\_alloc\_safe}}(\textcolor{keywordtype}{size\_t}\ size,\ uint64\_t\ lifetime\_ticks,\ uint64\_t\ now,\ \_Bool\ is\_const,\ \_Bool\ is\_volatile,\ \_Bool\ allow\_direct,\ \_Bool\ is\_root,\ \mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdad}{ttak\_mem\_flags\_t}}\ flags);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00072}00072\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00073}00073\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00074}00074\ \textcolor{comment}{\ *\ @brief\ Reallocates\ memory\ with\ lifecycle\ management.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00075}00075\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00076}\mbox{\hyperlink{mem_8h_a7eec3d633592a863f39155500dd0227a}{00076}}\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{mem_8h_a7eec3d633592a863f39155500dd0227a}{ttak\_mem\_realloc\_safe}}(\textcolor{keywordtype}{void}\ *ptr,\ \textcolor{keywordtype}{size\_t}\ new\_size,\ uint64\_t\ lifetime\_ticks,\ uint64\_t\ now,\ \_Bool\ is\_root,\ \mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdad}{ttak\_mem\_flags\_t}}\ flags);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00077}00077\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00078}00078\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00079}00079\ \textcolor{comment}{\ *\ @brief\ Duplicates\ a\ memory\ block\ with\ lifecycle\ management.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00080}00080\ \textcolor{comment}{\ *\ Provides\ a\ highly\ optimized\ internal\ path\ for\ cloning\ structures\ and\ buffers.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00081}00081\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00082}\mbox{\hyperlink{mem_8h_af356aeb5f83df49f650bc4283de8d931}{00082}}\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{mem_8h_af356aeb5f83df49f650bc4283de8d931}{ttak\_mem\_dup\_safe}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *src,\ \textcolor{keywordtype}{size\_t}\ size,\ uint64\_t\ lifetime\_ticks,\ uint64\_t\ now,\ \_Bool\ is\_root,\ \mbox{\hyperlink{mem_8h_a05020ce7df6068f7d7f515ee4ea9cdad}{ttak\_mem\_flags\_t}}\ flags);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00083}00083\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00084}00084\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00085}00085\ \textcolor{comment}{\ *\ @brief\ Frees\ the\ memory\ block\ and\ removes\ it\ from\ the\ global\ shadow\ map.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00086}00086\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00087}\mbox{\hyperlink{mem_8h_afdcd75479e1ca4dde197214d0430de65}{00087}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{mem_8h_afdcd75479e1ca4dde197214d0430de65}{ttak\_mem\_free}}(\textcolor{keywordtype}{void}\ *ptr);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00088}00088\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00089}00089\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00090}00090\ \textcolor{comment}{\ *\ @brief\ Accesses\ the\ memory\ block,\ verifying\ its\ lifecycle\ and\ security.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00091}00091\ \textcolor{comment}{\ *\ Inlined\ for\ maximum\ performance\ ("{}grotesque\ tweak"{}).}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00092}00092\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00093}\mbox{\hyperlink{mem_8h_ab6f5b08c17dc0db9a4b09eeb8bab4dc6}{00093}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{mem_8h_ab6f5b08c17dc0db9a4b09eeb8bab4dc6}{ttak\_mem\_access}}(\textcolor{keywordtype}{void}\ *ptr,\ uint64\_t\ now)\ \{}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00094}00094\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ptr)\ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00095}00095\ \ \ \ \ \mbox{\hyperlink{structttak__mem__header__t}{ttak\_mem\_header\_t}}\ *header\ =\ (\mbox{\hyperlink{structttak__mem__header__t}{ttak\_mem\_header\_t}}\ *)ptr\ -\/\ 1;}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00096}00096\ }
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00097}00097\ \ \ \ \ \textcolor{comment}{//\ Fast\ path:\ Optimistic\ lock-\/free\ check}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00098}00098\ \ \ \ \ \textcolor{keywordflow}{if}\ (header-\/>\mbox{\hyperlink{structttak__mem__header__t_a63c543d0e2277438790686ca125adadf}{magic}}\ !=\ \mbox{\hyperlink{mem_8h_a02d61fafa21eadc8010ca9803d77bafb}{TTAK\_MAGIC\_NUMBER}})\ \textcolor{keywordflow}{return}\ NULL;\ \textcolor{comment}{//\ Basic\ sanity}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00099}00099\ \ \ \ \ \textcolor{keywordflow}{if}\ (header-\/>\mbox{\hyperlink{structttak__mem__header__t_a86b5bea8ae5d34192969173c8ea7ef88}{freed}})\ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00100}00100\ \ \ \ \ \textcolor{keywordflow}{if}\ (header-\/>\mbox{\hyperlink{structttak__mem__header__t_a0362d896df5d92be01157426136ad6b0}{expires\_tick}}\ !=\ \mbox{\hyperlink{mem_8h_a798ceb4ce7e1d84af3001d7ec38d3da2}{\_\_TTAK\_UNSAFE\_MEM\_FOREVER\_\_}}\ \&\&\ now\ >\ header-\/>\mbox{\hyperlink{structttak__mem__header__t_a0362d896df5d92be01157426136ad6b0}{expires\_tick}})\ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00101}00101\ \ \ \ \ \textcolor{keywordflow}{if}\ (!header-\/>\mbox{\hyperlink{structttak__mem__header__t_afebc4673ac816dd1ca85e2368dee4694}{allow\_direct\_access}})\ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00102}00102\ }
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00103}00103\ \ \ \ \ \textcolor{comment}{//\ Atomic\ increment\ without\ lock}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00104}00104\ \ \ \ \ \textcolor{comment}{//\ Using\ GCC/Clang\ builtin\ for\ speed\ if\ available,\ else\ ttak\ wrapper}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00105}00105\ \ \ \ \ \textcolor{comment}{//\ ttak\_atomic\_inc64\ is\ likely\ a\ wrapper.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00106}00106\ \ \ \ \ \textcolor{comment}{//\ Let's\ use\ the\ library's\ function.\ }}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00107}00107\ \ \ \ \ \textcolor{comment}{//\ Since\ it's\ inline,\ we\ need\ to\ ensure\ ttak\_atomic\_inc64\ is\ visible.\ It\ is\ (included\ above).}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00108}00108\ \ \ \ \ \mbox{\hyperlink{atomic_8h_a1c3cfff1b58f14df90cc576695d291cb}{ttak\_atomic\_inc64}}(\&header-\/>\mbox{\hyperlink{structttak__mem__header__t_a0318bb3cfda8bb54cf6ec0c43e6b2584}{access\_count}});}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00109}00109\ }
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00110}00110\ \ \ \ \ \textcolor{keywordflow}{return}\ ptr;}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00111}00111\ \}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00112}00112\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00113}00113\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00114}00114\ \textcolor{comment}{\ *\ @brief\ Inspects\ and\ returns\ pointers\ that\ are\ expired\ or\ have\ abnormal\ access\ counts.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00115}00115\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00116}\mbox{\hyperlink{mem_8h_ada3d51eee9ddc6a5859312387539df65}{00116}}\ \textcolor{keywordtype}{void}\ **\mbox{\hyperlink{mem_8h_ada3d51eee9ddc6a5859312387539df65}{tt\_inspect\_dirty\_pointers}}(uint64\_t\ now,\ \textcolor{keywordtype}{size\_t}\ *count\_out);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00117}00117\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00118}00118\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00119}00119\ \textcolor{comment}{\ *\ @brief\ Automatically\ cleans\ up\ expired\ memory\ blocks\ with\ adaptive\ scheduling.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00120}00120\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00121}\mbox{\hyperlink{mem_8h_af73ea5e149eaa8dc0df429ad1f27cd45}{00121}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{mem_8h_af73ea5e149eaa8dc0df429ad1f27cd45}{tt\_autoclean\_dirty\_pointers}}(uint64\_t\ now);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00122}00122\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00123}00123\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00124}00124\ \textcolor{comment}{\ *\ @brief\ Configures\ the\ global\ background\ GC\ (mem\_tree)\ parameters.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00125}00125\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00126}\mbox{\hyperlink{mem_8h_ae8973d60d53321ee8b36d15b1d7698ea}{00126}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{mem_8h_ae8973d60d53321ee8b36d15b1d7698ea}{ttak\_mem\_configure\_gc}}(uint64\_t\ min\_interval\_ns,\ uint64\_t\ max\_interval\_ns,\ \textcolor{keywordtype}{size\_t}\ pressure\_threshold);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00127}00127\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00128}00128\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00129}00129\ \textcolor{comment}{\ *\ @brief\ Cleans\ up\ and\ returns\ abnormal\ pointers.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00130}00130\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00131}\mbox{\hyperlink{mem_8h_a23a79fc56d219a37227ec07299e4571b}{00131}}\ \textcolor{keywordtype}{void}\ **\mbox{\hyperlink{mem_8h_a23a79fc56d219a37227ec07299e4571b}{tt\_autoclean\_and\_inspect}}(uint64\_t\ now,\ \textcolor{keywordtype}{size\_t}\ *count\_out);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00132}00132\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00133}00133\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00134}00134\ \textcolor{comment}{\ *\ @brief\ Sets\ the\ global\ memory\ tracing\ flag.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00135}00135\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00136}\mbox{\hyperlink{mem_8h_adfcac077aeb029c04c4fb47dc33116a0}{00136}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{mem_8h_adfcac077aeb029c04c4fb47dc33116a0}{ttak\_mem\_set\_trace}}(\textcolor{keywordtype}{int}\ enable);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00137}00137\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00138}00138\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00139}00139\ \textcolor{comment}{\ *\ @brief\ Returns\ whether\ memory\ tracing\ is\ currently\ enabled.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00140}00140\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00141}\mbox{\hyperlink{mem_8h_a901d371e2cc570055bc60bcea5653df5}{00141}}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{mem_8h_a901d371e2cc570055bc60bcea5653df5}{ttak\_mem\_is\_trace\_enabled}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00142}00142\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00143}00143\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00144}00144\ \textcolor{comment}{\ *\ @brief\ Calculates\ a\ 32-\/bit\ checksum\ for\ the\ memory\ header.}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00145}00145\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00146}\mbox{\hyperlink{mem_8h_ad663cf355d411491ef16fbaba940be07}{00146}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ uint32\_t\ \mbox{\hyperlink{mem_8h_ad663cf355d411491ef16fbaba940be07}{ttak\_calc\_header\_checksum}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structttak__mem__header__t}{ttak\_mem\_header\_t}}\ *h)\ \{}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00147}00147\ \ \ \ \ uint32\_t\ sum1\ =\ h-\/>\mbox{\hyperlink{structttak__mem__header__t_a63c543d0e2277438790686ca125adadf}{magic}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00148}00148\ \ \ \ \ uint32\_t\ sum2\ =\ (uint32\_t)h-\/>\mbox{\hyperlink{structttak__mem__header__t_aefba5a41d63f62a6de53c3a9a6f0f51b}{created\_tick}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00149}00149\ \ \ \ \ sum1\ \string^=\ (uint32\_t)(h-\/>\mbox{\hyperlink{structttak__mem__header__t_aefba5a41d63f62a6de53c3a9a6f0f51b}{created\_tick}}\ >>\ 32);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00150}00150\ \ \ \ \ sum2\ \string^=\ (uint32\_t)h-\/>\mbox{\hyperlink{structttak__mem__header__t_a0362d896df5d92be01157426136ad6b0}{expires\_tick}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00151}00151\ \ \ \ \ sum1\ \string^=\ (uint32\_t)(h-\/>\mbox{\hyperlink{structttak__mem__header__t_a0362d896df5d92be01157426136ad6b0}{expires\_tick}}\ >>\ 32);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00152}00152\ \ \ \ \ sum2\ \string^=\ (uint32\_t)h-\/>\mbox{\hyperlink{structttak__mem__header__t_a576f96336f81e4af314e70b911232dda}{size}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00153}00153\ \textcolor{preprocessor}{\#if\ defined(\_\_LP64\_\_)\ ||\ defined(\_WIN64)}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00154}00154\ \ \ \ \ sum1\ \string^=\ (uint32\_t)(h-\/>\mbox{\hyperlink{structttak__mem__header__t_a576f96336f81e4af314e70b911232dda}{size}}\ >>\ 32);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00155}00155\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00156}00156\ \ \ \ \ sum2\ \string^=\ (uint32\_t)h-\/>\mbox{\hyperlink{structttak__mem__header__t_a8430c7b034f0da69e2fe16ae2a999e2d}{should\_join}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00157}00157\ \ \ \ \ sum1\ \string^=\ (uint32\_t)h-\/>\mbox{\hyperlink{structttak__mem__header__t_a4de6b9462e84fa2602c694e3e9633b9e}{strict\_check}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00158}00158\ \ \ \ \ sum2\ \string^=\ (uint32\_t)h-\/>\mbox{\hyperlink{structttak__mem__header__t_ad1189a2d1c2973b2537c1e4d34a0d439}{is\_root}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00159}00159\ \ \ \ \ sum1\ \string^=\ (uint32\_t)h-\/>\mbox{\hyperlink{structttak__mem__header__t_aeb69c52bed0292761ce4ff581eae37df}{canary\_start}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00160}00160\ \ \ \ \ sum2\ \string^=\ (uint32\_t)(h-\/>\mbox{\hyperlink{structttak__mem__header__t_aeb69c52bed0292761ce4ff581eae37df}{canary\_start}}\ >>\ 32);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00161}00161\ \ \ \ \ sum1\ \string^=\ (uint32\_t)h-\/>\mbox{\hyperlink{structttak__mem__header__t_a9bc5cff0708537fe474f41e356e69284}{canary\_end}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00162}00162\ \ \ \ \ sum2\ \string^=\ (uint32\_t)(h-\/>\mbox{\hyperlink{structttak__mem__header__t_a9bc5cff0708537fe474f41e356e69284}{canary\_end}}\ >>\ 32);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00163}00163\ \ \ \ \ \textcolor{keywordflow}{return}\ sum1\ \string^\ sum2;}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00164}00164\ \}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00166}00166\ \textcolor{comment}{/*\ Compatibility\ macros\ */}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00167}\mbox{\hyperlink{mem_8h_ab724d37f1a1c16f006309b8b2036b232}{00167}}\ \textcolor{keyword}{typedef}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{mem_8h_ab724d37f1a1c16f006309b8b2036b232}{ttak\_lifecycle\_obj\_t}};}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00168}\mbox{\hyperlink{mem_8h_aa4fb4762838f23fd8edc26f01d12f0e5}{00168}}\ \textcolor{preprocessor}{\#define\ ttak\_mem\_alloc(size,\ lifetime,\ now)\ ttak\_mem\_alloc\_safe(size,\ lifetime,\ now,\ false,\ false,\ true,\ false,\ TTAK\_MEM\_DEFAULT)}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00169}\mbox{\hyperlink{mem_8h_a29ae926197a7e7154d98730bd3de6242}{00169}}\ \textcolor{preprocessor}{\#define\ ttak\_mem\_alloc\_with\_flags(size,\ lifetime,\ now,\ flags)\ ttak\_mem\_alloc\_safe(size,\ lifetime,\ now,\ false,\ false,\ true,\ false,\ flags)}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00170}\mbox{\hyperlink{mem_8h_aecbcfc6a4045b6bd854f785a49706a77}{00170}}\ \textcolor{preprocessor}{\#define\ ttak\_mem\_realloc(ptr,\ size,\ lifetime,\ now)\ ttak\_mem\_realloc\_safe(ptr,\ size,\ lifetime,\ now,\ false,\ TTAK\_MEM\_DEFAULT)}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00171}\mbox{\hyperlink{mem_8h_ac436c1f90ce06b2759063c0d124cbd90}{00171}}\ \textcolor{preprocessor}{\#define\ ttak\_mem\_realloc\_with\_flags(ptr,\ size,\ lifetime,\ now,\ flags)\ ttak\_mem\_realloc\_safe(ptr,\ size,\ lifetime,\ now,\ false,\ flags)}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00172}\mbox{\hyperlink{mem_8h_aafdc8a651b46ebef1e1055f9ec21c03b}{00172}}\ \textcolor{preprocessor}{\#define\ ttak\_mem\_dup(src,\ size,\ lifetime,\ now)\ ttak\_mem\_dup\_safe(src,\ size,\ lifetime,\ now,\ false,\ TTAK\_MEM\_DEFAULT)}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00173}\mbox{\hyperlink{mem_8h_abc7e126aa61344f6b46c2508a9901ebf}{00173}}\ \textcolor{preprocessor}{\#define\ ttak\_mem\_dup\_with\_flags(src,\ size,\ lifetime,\ now,\ flags)\ ttak\_mem\_dup\_safe(src,\ size,\ lifetime,\ now,\ false,\ flags)}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00174}00174\ }
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00175}00175\ \textcolor{preprocessor}{\#if\ EMBEDDED}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00176}00176\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{buddy_8h_ae83acf1c249899b6fcfc4580dbf0b082}{ttak\_mem\_buddy\_init}}(\textcolor{keywordtype}{void}\ *pool\_start,\ \textcolor{keywordtype}{size\_t}\ pool\_len,\ \textcolor{keywordtype}{int}\ embedded\_mode);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00177}00177\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{buddy_8h_a9cc9a5945e39175f56fbf3ee961ff546}{ttak\_mem\_buddy\_set\_pool}}(\textcolor{keywordtype}{void}\ *pool\_start,\ \textcolor{keywordtype}{size\_t}\ pool\_len);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00178}00178\ \textcolor{keywordtype}{void}\ ttak\_mem\_set\_embedded\_pool(\textcolor{keywordtype}{void}\ *pool\_start,\ \textcolor{keywordtype}{size\_t}\ pool\_len);}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00179}00179\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00180}00180\ }
\DoxyCodeLine{\Hypertarget{mem_8h_source_l00181}00181\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ TTAK\_MEM\_H}}

\end{DoxyCode}
